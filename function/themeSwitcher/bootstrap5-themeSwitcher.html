<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Bootstrap 5 Theme Switcher with Icon</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>

<body>
   <ul class="nav">
      <li class="nav-item dropdown">
         <button class="btn btn-sm nav-link d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false"
            data-bs-toggle="dropdown" aria-label="Toggle theme (auto)">
            <i class="bi theme-icon-active"></i>
         </button>
         <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="bd-theme">
            <li>
               <button type="button" class="dropdown-item d-flex align-items-center" data-theme-value="light">
                  <i class="bi bi-sun-fill me-2 opacity-50 theme-icon"></i>
                  Light
               </button>
            </li>
            <li>
               <button type="button" class="dropdown-item d-flex align-items-center" data-theme-value="dark">
                  <i class="bi bi-moon-stars-fill me-2 opacity-50 theme-icon"></i>
                  Dark
               </button>
            </li>
            <li>
               <button type="button" class="dropdown-item d-flex align-items-center" data-theme-value="auto">
                  <i class="bi bi-circle-half me-2 opacity-50 theme-icon"></i>
                  Auto
               </button>
            </li>
         </ul>
      </li>

   </ul>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
   <script>
      (() => {
         'use strict'

         const storedTheme = localStorage.getItem('theme')

         const getPreferredTheme = () => {
            if (storedTheme) {
               return storedTheme
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
         }

         const setTheme = function (theme) {
            if (theme === 'auto') {
               document.documentElement.setAttribute('data-bs-theme',
                  window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
               )
            } else {
               document.documentElement.setAttribute('data-bs-theme', theme)
            }
         }

         setTheme(getPreferredTheme())

         const showActiveTheme = (theme) => {
            const activeIcon = document.querySelector('.theme-icon-active')
            const btnToActive = document.querySelector(`[data-theme-value="${theme}"]`)
            const iconFromBtn = btnToActive.querySelector('i').getAttribute('class')

            document.querySelectorAll('[data-theme-value]').forEach(el => {
               el.classList.remove('active')
            })

            btnToActive.classList.add('active')
            activeIcon.setAttribute('class', iconFromBtn + ' theme-icon-active')
         }

         window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            if (storedTheme === 'auto') {
               setTheme(getPreferredTheme())
            }
         })

         window.addEventListener('DOMContentLoaded', () => {
            showActiveTheme(getPreferredTheme())

            document.querySelectorAll('[data-theme-value]').forEach(toggle => {
               toggle.addEventListener('click', () => {
                  const theme = toggle.getAttribute('data-theme-value')
                  localStorage.setItem('theme', theme)
                  setTheme(theme)
                  showActiveTheme(theme)
               })
            })
         })
      })()
   </script>

</body>

</html>